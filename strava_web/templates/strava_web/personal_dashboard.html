{% extends "strava_web/base.html" %}
{% load i18n %}
{% load strava_filters %}

{% block title %}{% trans "My Dashboard" %}{% endblock %}

{% block content %}
    <h2>{% trans "Welcome, " %}{{ user.get_full_name|default:user.username }}!</h2>
    <p>{% trans "This is your personal dashboard." %}</p>
    <h3>{% trans "Your Information:" %}</h3>
    <ul>
        <li>{% trans "Username:" %} {{ user.username }}</li>
        <li>{% trans "Email:" %} {{ user.email|default:user.username }}</li>
        <li>{% trans "Name:" %} {{ user.first_name|default:"" }} {{ user.last_name|default:"" }}</li>
        <li>{% trans "Strava Connected:" %} {% if user.is_strava_connected %}{% trans "Yes" %} (ID: {{ user.strava_id }}){% else %}{% trans "No" %}{% endif %}</li>
        <li>{% trans "Last Strava Sync:" %} {% if user.last_strava_sync %}{{ user.last_strava_sync|date:"Y-m-d H:i" }}{% else %}{% trans "Never" %}{% endif %}</li>
    </ul>

    {% if user.is_strava_connected %}
        <h3>{% trans "Your Strava Run Statistics:" %}</h3>
        <h4>{% trans "This Week (Weekly Totals)" %}</h4>
        <table>
            <tr><td>{% trans "Run Count" %}</td><td colspan="2">{{ user.weekly_run_count|default:0 }}</td></tr>
            <tr><td>{% trans "Distance" %}</td><td>{{ user.weekly_run_distance|default:0|div:1000|floatformat:2 }} {% trans "km" %}</td><td>{{ user.weekly_run_distance|default:0|div:1609.34|floatformat:2 }} {% trans "mile" %}</td></tr>
            <tr><td>{% trans "Moving Time" %}</td><td>{{ user.weekly_run_moving_time }} {% trans "s" %}</td><td>{{ user.weekly_run_moving_time|default:0|duration:1 }}</td></tr>
            <tr><td>{% trans "Elapsed Time" %}</td><td>{{ user.weekly_run_elapsed_time }} {% trans "s" %}</td><td>{{ user.weekly_run_elapsed_time|default:0|duration:1 }}</td></tr>
            <tr><td>{% trans "Elevation Gain" %}</td><td colspan="2">{{ user.weekly_run_elevation_gain|default:0|floatformat:0 }} {% trans "m" %}</td></tr>
            <tr><td>{% trans "Average Pace" %}</td><td>{{ user.weekly_run_distance|default:0|km_pace:user.weekly_run_moving_time }}/{% trans "km" %}</td><td>{{ user.weekly_run_distance|default:0|mile_pace:user.weekly_run_moving_time }}/{% trans "mile" %}</td></tr>
            <tr><td>{% trans "Heart Rate" %}</td><td>{% if user.weekly_avg_heartrate %}{{ user.weekly_avg_heartrate|default:0|floatformat:0 }} {% trans "bpm" %}{% else %}-{% endif %}</td><td>{% if user.weekly_max_heartrate %}{{ user.weekly_max_heartrate|default:0|floatformat:0 }} {% trans "bpm (max)" %}{% else %}-{% endif %}</td></tr>
        </table>

        <h4>{% trans "Year To Date (YTD Totals)" %}</h4>
        <table>
            <tr><td>{% trans "Run Count" %}</td><td colspan="2">{{ user.ytd_run_count|default:0 }}</td></tr>
            <tr><td>{% trans "Distance" %}</td><td>{{ user.ytd_run_distance|default:0|div:1000|floatformat:2 }} {% trans "km" %}</td><td>{{ user.ytd_run_distance|default:0|div:1609.34|floatformat:2 }} {% trans "mile" %}</td></tr>
            <tr><td>{% trans "Moving Time" %}</td><td>{{ user.ytd_run_moving_time }} {% trans "s" %}</td><td>{{ user.ytd_run_moving_time|default:0|duration:1 }}</td></tr>
            <tr><td>{% trans "Elapsed Time" %}</td><td>{{ user.ytd_run_elapsed_time }} {% trans "s" %}</td><td>{{ user.ytd_run_elapsed_time|default:0|duration:1 }}</td></tr>
            <tr><td>{% trans "Elevation Gain" %}</td><td colspan="2">{{ user.ytd_run_elevation_gain|default:0|floatformat:0 }} {% trans "m" %}</td></tr>
        </table>

        <h4>{% trans "All Time Totals" %}</h4>
        <table>
            <tr><td>{% trans "Run Count" %}</td><td colspan="2">{{ user.all_time_run_count|default:0 }}</td></tr>
            <tr><td>{% trans "Distance" %}</td><td>{{ user.all_time_run_distance|default:0|div:1000|floatformat:2 }} {% trans "km" %}</td><td>{{ user.all_time_run_distance|default:0|div:1609.34|floatformat:2 }} {% trans "mile" %}</td></tr>
            <tr><td>{% trans "Moving Time" %}</td><td>{{ user.all_time_run_moving_time }} {% trans "s" %}</td><td>{{ user.all_time_run_moving_time|default:0|duration:1 }}</td></tr>
            <tr><td>{% trans "Elapsed Time" %}</td><td>{{ user.all_time_run_elapsed_time }} {% trans "s" %}</td><td>{{ user.all_time_run_elapsed_time|default:0|duration:1 }}</td></tr>
            <tr><td>{% trans "Elevation Gain" %}</td><td colspan="2">{{ user.all_time_run_elevation_gain|default:0|floatformat:0 }} {% trans "m" %}</td></tr>
        </table>
        <p><a href="{% url 'group_membership_edit' %}" class="button-link">{% trans "Manage Group Memberships" %}</a></p>
    {% else %}
        <p>{% trans "Connect your Strava account to see your personal statistics and activities!" %}</p>
        <p><a href="{% url 'strava_login' %}" class="button-link" style="background-color: #fc4c02;">{% trans "Connect Strava Account" %}</a></p>
    {% endif %}

    <h3>{% trans "Your Groups:" %}</h3>
    {% if user_groups %}
        <ul>
            {% for group in user_groups %}
                <li>
                    {{ group.name }} 
                    {% if group.has_dashboard %}
                        <a href="{% url 'group_dashboard' group.id %}" style="margin-left: 10px;">{% trans "View Dashboard" %}</a>
                    {% endif %}
                </li>
            {% endfor %}
        </ul>
    {% else %}
        <p>{% trans "You are not a member of any groups yet." %}</p>
        <p><a href="{% url 'discover_groups' %}" class="button-link">{% trans "Discover Groups" %}</a></p>
    {% endif %}
{% endblock %}